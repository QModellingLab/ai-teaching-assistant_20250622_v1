<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š {{ student.name }} - å€‹äººå­¸ç¿’æ‘˜è¦</title>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <nav class="mobile-nav">
        <div class="nav-header">
            <h1>ğŸ“Š å­¸ç¿’æ‘˜è¦</h1>
            <button class="nav-toggle" onclick="toggleMobileNav()">â˜°</button>
        </div>
        <div class="nav-menu" id="mobile-menu">
            <a href="/students">ğŸ‘¥ å­¸ç”Ÿåˆ—è¡¨</a>
            <a href="/teaching-insights">ğŸ“ˆ æ•™å­¸æ´å¯Ÿ</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="student-header">
            <div class="student-avatar-large">
                <span class="avatar-text">{{ student.name[0] }}</span>
            </div>
            <div class="student-header-info">
                <h1 class="student-name">ğŸ‘¤ {{ student.name }}</h1>
                <p class="student-subtitle">ğŸ“Š å€‹äººå­¸ç¿’æ‘˜è¦åˆ†æ</p>
            </div>
        </div>
        
        <div id="loading-container" class="loading-container text-center" style="display: none;">
            <div class="loading-spinner"></div>
            <div class="loading-text">ğŸ¤– AIæ­£åœ¨åˆ†æå­¸ç¿’è¨˜éŒ„...</div>
        </div>
        
        <div id="summary-container" class="summary-container">
            {% if summary_data.status == 'success' %}
                <div class="card mb-6">
                    <div class="card-header">
                        <h2>ğŸ¤– AIå­¸ç¿’åˆ†æå ±å‘Š</h2>
                        <span class="analysis-badge success">åˆ†æå®Œæˆ</span>
                    </div>
                    <div class="summary-content">
                        {{ summary_data.summary | safe }}
                    </div>
                    
                    <div class="summary-meta">
                        ğŸ“… åˆ†ææ™‚é–“ï¼š{{ summary_data.generated_at }}
                        {% if summary_data.message_count %}
                        | ğŸ“Š åˆ†æè¨Šæ¯æ•¸ï¼š{{ summary_data.message_count }}
                        {% endif %}
                    </div>
                </div>
                
            {% elif summary_data.status == 'fallback' %}
                <div class="card mb-6">
                    <div class="card-header">
                        <h2>ğŸ“Š åŸºæœ¬å­¸ç¿’çµ±è¨ˆ</h2>
                        <span class="analysis-badge warning">å‚™ç”¨æ¨¡å¼</span>
                    </div>
                    <div class="summary-content">
                        {{ summary_data.summary | safe }}
                    </div>
                    
                    <div class="alert alert-warning">
                        â„¹ï¸ {{ summary_data.message }}
                        <button onclick="retryAnalysis()" class="btn btn-sm btn-primary ml-2">
                            ğŸ”„ é‡æ–°å˜—è©¦AIåˆ†æ
                        </button>
                    </div>
                </div>
                
            {% else %}
                <div class="card mb-6">
                    <div class="error-container text-center">
                        <div class="error-icon">âš ï¸</div>
                        <h3>åˆ†æå¤±æ•—</h3>
                        <div class="error-message">
                            {{ summary_data.message or 'ç„¡æ³•ç”Ÿæˆå­¸ç¿’æ‘˜è¦ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚' }}
                        </div>
                        <button onclick="retryAnalysis()" class="btn btn-primary mt-4">
                            ğŸ”„ é‡æ–°åˆ†æ
                        </button>
                    </div>
                </div>
            {% endif %}
            
            <div class="quick-stats grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="stat-card-small">
                    <div class="stat-icon">ğŸ’¬</div>
                    <div class="stat-number">{{ summary_data.data.total_messages or 0 }}</div>
                    <div class="stat-label">ç¸½è¨Šæ¯æ•¸</div>
                </div>
                <div class="stat-card-small">
                    <div class="stat-icon">â“</div>
                    <div class="stat-number">{{ summary_data.data.question_count or 0 }}</div>
                    <div class="stat-label">æå•æ•¸é‡</div>
                </div>
                <div class="stat-card-small">
                    <div class="stat-icon">ğŸ“…</div>
                    <div class="stat-number">
                        {% if summary_data.data.last_active %}
                            {{ (now() - summary_data.data.last_active).days }}
                        {% else %}
                            --
                        {% endif %}
                    </div>
                    <div class="stat-label">å¤©å‰æ´»å‹•</div>
                </div>
                <div class="stat-card-small">
                    <div class="stat-icon">ğŸ“ˆ</div>
                    <div class="stat-number">{{ summary_data.data.engagement_score or '--' }}</div>
                    <div class="stat-label">åƒèˆ‡åº¦</div>
                </div>
            </div>
            
            <div class="action-buttons text-center">
                <a href="/students/{{ student.id }}" class="btn btn-secondary">
                    ğŸ“ æŸ¥çœ‹å®Œæ•´è¨˜éŒ„
                </a>
                <button onclick="downloadStudentQuestions({{ student.id }})" class="btn btn-primary">
                    ğŸ“¥ ä¸‹è¼‰æå•è¨˜éŒ„
                </button>
                <button onclick="shareStudentSummary()" class="btn btn-success">
                    ğŸ“¤ åˆ†äº«æ‘˜è¦
                </button>
            </div>
        </div>
    </div>
    
    <script src="/static/js/progress.js"></script>
    <script src="/static/js/ui-helpers.js"></script>
    <script>
        function retryAnalysis() {
            showProgress('é‡æ–°åˆ†æ', 'AIæ­£åœ¨é‡æ–°åˆ†æå­¸ç¿’è¨˜éŒ„...', 0);
            
            setTimeout(() => updateProgress('åˆ†æå­¸ç¿’æ¨¡å¼...', 30), 1000);
            setTimeout(() => updateProgress('ç”Ÿæˆå€‹äººåŒ–æ´å¯Ÿ...', 70), 2000);
            setTimeout(() => updateProgress('å®Œæˆåˆ†æï¼', 100), 3000);
            setTimeout(() => {
                hideProgress();
                window.location.reload();
            }, 3500);
        }
        
        function shareStudentSummary() {
            const summaryText = document.querySelector('.summary-content').textContent;
            const shareData = {
                title: '{{ student.name }} çš„å­¸ç¿’æ‘˜è¦',
                text: summaryText.substring(0, 200) + '...',
                url: window.location.href
            };
            
            if (navigator.share) {
                navigator.share(shareData);
            } else {
                copyToClipboard(window.location.href);
                showSuccess('æ‘˜è¦é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
            }
        }
        
        function toggleMobileNav() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('active');
        }
    </script>
</body>
</html>
